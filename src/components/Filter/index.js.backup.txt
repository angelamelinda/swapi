import React, { Component } from 'react';
import axios from 'axios';
import './style.css';
class Filter extends Component {
    constructor(props) {
        super(props);
        this.state = {
            filterOpen: false,
            isFetching: false,
            films: []
        }
        this.toggleFilter = this.toggleFilter.bind(this);
    }
    toggleFilter() {
        this.setState(prevState => ({
            filterOpen: !prevState.filterOpen
        }))
    }
    componentWillMount() {
        this.fetchData();
    }
    // async fetchPlanet() {
    //     let tempData = [],
    //         pages = 1,
    //         url = 'https://swapi.co/api/films/';
    //     while(true) {
    //         let res = await axios.get(url+(pages++));
    //         if(res.status == 200) {
    //             let data = await res.data;
    //             // tempData = [...tempData, data];
    //             this.setState({
    //                 films: [...this.state.films, data]
    //             })
    //         } 
    //     }
    // }
    fetchData() {
        let tempData = [],
            pages = 1;
        this.fetching(tempData, pages);
    }
    fetching(tempData, pages) {
        let url = 'https://swapi.co/api/films/';
        axios.get(url+(pages++)).then((resp) => {
            if(resp.status == 200) {
                tempData = [...tempData, resp.data];
                this.fetching(tempData, pages++);
            } 
            this.setState({
                isFetching: true
            })
        }).catch(() => {
            this.setState({
                films: tempData,
                isFetching: false
            })
        });
    }
    isEmpty(obj) {
        for(var key in obj) {
          if(obj.hasOwnProperty(key))
            return false;
        }
        return true;
      }
    render() { 
        return (
            <div className={ this.state.filterOpen ? 'filter-tools opened' : 'filter-tools'}>
                <h4 className="font-starjedi-rounded text-center color-white pt-3 mb-3 cursor-pointer" onClick={this.toggleFilter}>Filter Planets</h4>
                <ul className="list-filter list-unstyled mb-0 overflow-y-scroll">
                    {
                        (this.state.isFetching != true) ? (
                            Object.keys(this.state.films).map((key,id) => (
                                <li><label htmlFor=""><input type="checkbox"/> {this.state.films[key].title}</label></li>
                            ))
                        ) : (<p className="mb-0 color-white">Please wait...</p>)
                    }
                </ul>
            </div>
        )
    }
}

export default Filter;